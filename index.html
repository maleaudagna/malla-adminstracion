<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular - Administraci√≥n UNSa</title>
    <style>
        /* --- General Styles & Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --color-bg: #f4f7f9;
            --color-card-bg: #ffffff;
            --color-text: #333333;
            --color-header: #2c3e50;
            --color-border: #e0e0e0;
            --color-shadow: rgba(0, 0, 0, 0.08);
            --color-approved: #27ae60;
            --color-approved-bg: #eaf8f0;
            --color-locked: #95a5a6;
            --color-locked-bg: #f2f4f4;
            --color-tooltip-bg: #34495e;
            --color-tooltip-text: #ffffff;
            --font-main: 'Roboto', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 2em;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Header and Title --- */
        .header {
            text-align: center;
            margin-bottom: 2em;
        }

        .header h1 {
            color: var(--color-header);
            font-size: 2.5em;
            margin-bottom: 0.2em;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            color: #7f8c8d;
        }
        
        /* --- Main Grid Container --- */
        #career-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 1500px;
        }

        /* --- Year Column --- */
        .year-column {
            background-color: var(--color-card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px var(--color-shadow);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .year-column h2 {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--color-header);
            text-align: center;
            margin: 0 0 10px 0;
            border-bottom: 2px solid #e0e6ed;
            padding-bottom: 10px;
        }

        /* --- Subject Card --- */
        .subject {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-left: 5px solid var(--color-header);
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 80px;
        }
        
        .subject:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px var(--color-shadow);
        }
        
        .subject-name {
            font-weight: 500;
            font-size: 0.95em;
            margin-bottom: 10px;
        }
        
        .subject-id {
            font-size: 0.8em;
            color: #7f8c8d;
            position: absolute;
            top: 10px;
            right: 15px;
            background-color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .subject-meta {
            font-size: 0.85em;
            color: #7f8c8d;
            font-weight: 500;
        }

        /* --- Subject States --- */
        .subject.approved {
            background-color: var(--color-approved-bg);
            border-left: 5px solid var(--color-approved);
        }

        .subject.locked {
            background-color: var(--color-locked-bg);
            border-left-color: var(--color-locked);
            color: var(--color-locked);
            cursor: not-allowed;
            opacity: 0.8;
        }

        .subject.locked:hover {
            transform: none;
            box-shadow: none;
        }
        
        .subject.locked::after {
            content: 'üîí';
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 1.2em;
        }

        /* --- Tooltip for Locked Subjects --- */
        .tooltip {
            visibility: hidden;
            width: max-content;
            max-width: 220px;
            background-color: var(--color-tooltip-bg);
            color: var(--color-tooltip-text);
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10;
            bottom: 105%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
            pointer-events: none;
        }
        
        .tooltip::after { /* Tooltip arrow */
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--color-tooltip-bg) transparent transparent transparent;
        }

        .subject.locked:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        /* --- Responsive Design --- */
        @media (max-width: 1200px) { #career-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { body { padding: 1em; } .header h1 { font-size: 2em; } #career-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 500px) { #career-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header class="header">
        <h1>Plan de Estudios - Administraci√≥n</h1>
        <p>Facultad de Ciencias Econ√≥micas, Jur√≠dicas y Sociales - UNSa</p>
    </header>

    <div id="career-grid">
        </div>

    <script>
        const materias = [
            // 1¬∫ A√±o
            { id: 51, name: 'Introducci√≥n a la Contabilidad', year: 1, semester: 1, prereqs: [] },
            { id: 52, name: 'Derecho Civil', year: 1, semester: 1, prereqs: [] },
            { id: 53, name: 'Matem√°tica I', year: 1, semester: 1, prereqs: [] },
            { id: 54, name: 'Principios de Administraci√≥n', year: 1, semester: 1, prereqs: [] },
            { id: 55, name: 'Matem√°tica II', year: 1, semester: 2, prereqs: [53] },
            { id: 56, name: 'Contabilidad I', year: 1, semester: 2, prereqs: [51] },
            { id: 57, name: 'Econom√≠a I', year: 1, semester: 2, prereqs: [] },
            { id: 58, name: 'Derecho Constitucional', year: 1, semester: 2, prereqs: [] },

            // 2¬∫ A√±o
            { id: 59, name: 'Matem√°tica III', year: 2, semester: 1, prereqs: [53] },
            { id: 60, name: 'Econom√≠a II', year: 2, semester: 1, prereqs: [57] },
            { id: 61, name: 'Obligaciones, Contratos y T√≠tulos de Cr√©dito', year: 2, semester: 1, prereqs: [58] },
            { id: 62, name: 'Filosof√≠a', year: 2, semester: 1, prereqs: [] },
            { id: 63, name: 'Escritura Acad√©mica y Oratoria', year: 2, semester: 2, prereqs: [54] },
            { id: 64, name: 'Estad√≠stica I', year: 2, semester: 2, prereqs: [55] },
            { id: 65, name: 'Derecho Administrativo', year: 2, semester: 2, prereqs: [52] },
            { id: 66, name: 'Sociedades', year: 2, semester: 2, prereqs: [52] },
            { id: 67, name: 'Seminario de Ingl√©s T√©cnico', year: 2, semester: 2, prereqs: [] },

            // 3¬∫ A√±o
            { id: 68, name: 'C√°lculo Financiero', year: 3, semester: 1, prereqs: [55, 59] },
            { id: 69, name: 'Seminario de Responsabilidad S.', year: 3, semester: 1, prereqs: [56, 66] },
            { id: 70, name: 'Organizaci√≥n de Sistemas Administrativos', year: 3, semester: 1, prereqs: [54] },
            { id: 71, name: 'Estad√≠stica II', year: 3, semester: 1, prereqs: [64] },
            { id: 72, name: 'Derecho de Empresas en Crisis', year: 3, semester: 2, prereqs: [56, 66] },
            { id: 73, name: 'Administraci√≥n Financiera de Empresas I', year: 3, semester: 2, prereqs: [68, 60] },
            { id: 74, name: 'Administraci√≥n de Personal I', year: 3, semester: 2, prereqs: [54, 52] },
            { id: 75, name: 'Derecho Tributario', year: 3, semester: 2, prereqs: [65] },
            { id: 76, name: 'M√©todos Cuantitativos para los Negocios', year: 3, semester: 2, prereqs: [59, 64] },
            { id: 77, name: 'Taller de Seminario de TI', year: 3, semester: 2, prereqs: [59, 64, 68] },

            // 4¬∫ A√±o
            { id: 78, name: 'Derecho de Trabajo y de la S.S.', year: 4, semester: 1, prereqs: [58, 74] },
            { id: 79, name: 'Gesti√≥n de las Tecnolog√≠as de Informaci√≥n', year: 4, semester: 1, prereqs: [73] },
            { id: 80, name: 'Contabilidad y Costos para la Gesti√≥n', year: 4, semester: 1, prereqs: [56, 59] },
            { id: 81, name: 'Administraci√≥n de Personal II', year: 4, semester: 1, prereqs: [58, 74] },
            { id: 82, name: 'Administraci√≥n y Hacienda P√∫blica', year: 4, semester: 2, prereqs: [65] },
            { id: 83, name: 'Administraci√≥n Estrat√©gica', year: 4, semester: 2, prereqs: [70, 73, 79] },
            { id: 84, name: 'Administraci√≥n de la Producci√≥n y Operaciones', year: 4, semester: 2, prereqs: [71, 76] },
            { id: 85, name: 'Marketing Estrat√©gico', year: 4, semester: 2, prereqs: [57, 64, 71, 76, 80] },
            { id: 86, name: 'Actividad Curricular Optativa', year: 4, semester: 2, prereqs: [] },

            // 5¬∫ A√±o
            { id: 87, name: 'Marketing Operativo', year: 5, semester: 1, prereqs: [85] },
            { id: 88, name: 'Etica Profesional', year: 5, semester: 1, prereqs: [78,79,80,81,82,83,84,85,86] }, // Requiere 4to a√±o regular
            { id: 89, name: 'Administraci√≥n Financiera de Empresas II', year: 5, semester: 1, prereqs: [71, 80, 73] },
            { id: 90, name: 'Actividad Curricular Electiva', year: 5, semester: 2, prereqs: [] },
            { id: 91, name: 'Plan de Negocios y Emprendimiento', year: 5, semester: 2, prereqs: [80, 83] },
            { id: 92, name: 'Metodolog√≠a de la Investigaci√≥n Cient√≠fica', year: 5, semester: 2, prereqs: [78,79,80,81,82,83,84,85,86] }, // Requiere 4to a√±o regular
            { id: 93, name: 'Pr√°ctica Prof. Supervisada', year: 5, semester: 2, prereqs: [67], minApproved: 28 }, // --- L√çNEA CORREGIDA ---
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('career-grid');
            let approvedSubjects = new Set(JSON.parse(localStorage.getItem('approvedSubjects')) || []);

            function getSubjectById(id) {
                return materias.find(m => m.id === id);
            }

            function checkPrerequisites(subject) {
                const missingReasons = [];

                // 1. Chequear correlativas directas
                const missingCourses = subject.prereqs.filter(prereqId => !approvedSubjects.has(prereqId));
                if (missingCourses.length > 0) {
                    missingReasons.push(...missingCourses.map(id => getSubjectById(id).name));
                }

                // 2. Chequear cantidad m√≠nima de materias aprobadas
                if (subject.minApproved) {
                    const approvedCount = approvedSubjects.size;
                    if (approvedCount < subject.minApproved) {
                        missingReasons.push(`M√≠nimo ${subject.minApproved} materias (tienes ${approvedCount})`);
                    }
                }
                
                return {
                    met: missingReasons.length === 0,
                    missing: missingReasons
                };
            }
            
            function saveProgress() {
                localStorage.setItem('approvedSubjects', JSON.stringify(Array.from(approvedSubjects)));
            }

            function toggleSubject(subjectId) {
                const subjectElement = document.querySelector(`[data-id='${subjectId}']`);
                if (subjectElement.classList.contains('locked')) return;
                
                if (approvedSubjects.has(subjectId)) {
                    approvedSubjects.delete(subjectId);
                } else {
                    approvedSubjects.add(subjectId);
                }
                
                saveProgress();
                updateUI();
            }

            function updateUI() {
                materias.forEach(subject => {
                    const el = document.querySelector(`[data-id='${subject.id}']`);
                    if (!el) return;

                    const prereqStatus = checkPrerequisites(subject);
                    el.classList.remove('approved', 'locked');
                    const tooltip = el.querySelector('.tooltip');

                    if (approvedSubjects.has(subject.id)) {
                        el.classList.add('approved');
                    } else if (prereqStatus.met) {
                        // Disponible para cursar
                    } else {
                        el.classList.add('locked');
                        if (tooltip) {
                            tooltip.innerHTML = `Requiere:<br>${prereqStatus.missing.join('<br>')}`;
                        }
                    }
                });
            }

            function renderGrid() {
                const years = [...new Set(materias.map(m => m.year))];
                years.forEach(year => {
                    const column = document.createElement('div');
                    column.className = 'year-column';
                    column.innerHTML = `<h2>${year}¬∫ A√±o</h2>`;
                    grid.appendChild(column);
                });

                materias.forEach(subject => {
                    const column = grid.children[subject.year - 1];
                    const card
